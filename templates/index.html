<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-국방 AI 어시스턴트</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</head>

<body>
    <div class="app-container">
        <!-- 벡터 DB 선택 부분 변경 - 카테고리 트리 구조로 변경 -->
    <div class="sidebar">
        <h3>정보 <i id="admin-lock-icon" class="fas fa-lock admin-icon" title="문서 및 벡터 DB 관리"></i></h3>
        <p>🧑‍💻 K-국방 AI 어시스턴트</p>
        <p>✅ 군 모병에 대한 정확한 정보, 공식 문서를 기반으로 답변해 드립니다.</p>

               
        <div class="sidebar-divider"></div>
        
        <h3>메뉴 선택 <span class="required-mark">*</span></h3>
        <p class="db-selection-note">질문을 시작하려면 좌측 메뉴를 선택하세요</p>
        <div class="essential-menu-section">
            <div class="category-tree-menu db-selector-area">
                <!-- 카테고리별 트리 메뉴 -->
                {% set categories = {} %}
                {% for db in vector_dbs %}
                    {% if db.category is not defined %}
                        {% set _ = db.update({'category': '기타'}) %}
                    {% endif %}
                    {% if db.category not in categories %}
                        {% set _ = categories.update({db.category: []}) %}
                    {% endif %}
                    {% set _ = categories[db.category].append(db) %}
                {% endfor %}
                
                {% for category_name, dbs in categories.items() %}
                    <div class="category-folder">
                        <div class="category-header" data-category="{{ category_name }}">
                            <i class="fas fa-folder-closed"></i>
                            <span>{{ category_name }}</span>
                            <span class="db-count">({{ dbs|length }})</span>
                        </div>
                        <div class="category-items" id="category-items-{{ category_name|replace(' ', '-') }}" style="display: none;">
                            {% for db in dbs %}
                                <div class="db-item">
                                    <input type="radio" name="db-selector" id="db-{{ db.id }}" value="{{ db.id }}">
                                    <label for="db-{{ db.id }}">
                                        <i class="fas fa-database"></i> {{ db.name }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}           
            </div>
        </div>

        <div class="sidebar-divider"></div>
        <h3>대화 초기화</h3>
        <button id="clear-btn" class="btn btn-primary">새로운 주제로 질문</button>
    </div>
        
        <div class="main-content">
            <header>
                <h1>K-국방 AI 어시스턴트 💬</h1>
                <p>군 모병에 대한 정확한 정보, 공식 문서를 기반으로 답변해 드립니다.</p>
            </header>
            
            <div id="chat-container">
                <!-- 채팅 메시지가 여기에 추가됩니다 -->
            </div>
            
            <div id="status-container" class="hidden">
                <div class="status-message">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span id="status-text">😊 열심히 생각중 입니다...</span>
                </div>
                <div id="status-steps"></div>
            </div>
            
            <div class="input-container">
                <input type="text" id="user-input" placeholder="궁금한 내용을 물어보세요!" />
                <button id="send-btn" class="btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- 피드백 모달 -->
    <div id="feedback-modal" class="modal hidden">
        <div class="modal-content">
            <h2>답변 평가</h2>
            
            <div class="feedback-item">
                <label for="correctness">올바른 답변 (1:매우 낮음👎 ~ 5:매우 높음👍): 답변의 신뢰도</label>
                <div class="rating">
                    <input type="radio" name="correctness" value="1" id="correctness-1">
                    <label for="correctness-1">1</label>
                    <input type="radio" name="correctness" value="2" id="correctness-2">
                    <label for="correctness-2">2</label>
                    <input type="radio" name="correctness" value="3" id="correctness-3">
                    <label for="correctness-3">3</label>
                    <input type="radio" name="correctness" value="4" id="correctness-4">
                    <label for="correctness-4">4</label>
                    <input type="radio" name="correctness" value="5" id="correctness-5" checked>
                    <label for="correctness-5">5</label>
                </div>
            </div>
            
            <div class="feedback-item">
                <label for="helpfulness">도움됨 (1:매우 불만족👎 ~ 5:매우 만족👍): 답변 품질</label>
                <div class="rating">
                    <input type="radio" name="helpfulness" value="1" id="helpfulness-1">
                    <label for="helpfulness-1">1</label>
                    <input type="radio" name="helpfulness" value="2" id="helpfulness-2">
                    <label for="helpfulness-2">2</label>
                    <input type="radio" name="helpfulness" value="3" id="helpfulness-3">
                    <label for="helpfulness-3">3</label>
                    <input type="radio" name="helpfulness" value="4" id="helpfulness-4">
                    <label for="helpfulness-4">4</label>
                    <input type="radio" name="helpfulness" value="5" id="helpfulness-5" checked>
                    <label for="helpfulness-5">5</label>
                </div>
            </div>
            
            <div class="feedback-item">
                <label for="specificity">구체성 (1:매우 불만족👎 ~ 5:매우 만족👍): 답변의 구체성</label>
                <div class="rating">
                    <input type="radio" name="specificity" value="1" id="specificity-1">
                    <label for="specificity-1">1</label>
                    <input type="radio" name="specificity" value="2" id="specificity-2">
                    <label for="specificity-2">2</label>
                    <input type="radio" name="specificity" value="3" id="specificity-3">
                    <label for="specificity-3">3</label>
                    <input type="radio" name="specificity" value="4" id="specificity-4">
                    <label for="specificity-4">4</label>
                    <input type="radio" name="specificity" value="5" id="specificity-5" checked>
                    <label for="specificity-5">5</label>
                </div>
            </div>
            
            <div class="feedback-item">
                <label for="comment">의견(선택)</label>
                <textarea id="comment" placeholder="의견을 입력해주세요(선택)"></textarea>
            </div>
            
            <div class="modal-actions">
                <button id="submit-feedback" class="btn btn-primary">제출</button>
                <button id="cancel-feedback" class="btn">취소</button>
            </div>
        </div>
    </div>
</body>
</html>